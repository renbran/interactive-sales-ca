# ğŸ—ï¸ Scholarix CRM - System Architecture

## ğŸ“Š High-Level Architecture Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        USERS                                     â”‚
â”‚  ğŸ‘¤ Admin  â”‚  ğŸ‘¤ Agent  â”‚  ğŸ‘¤ Sales Manager                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   FRONTEND (React 19)                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚  Dashboard â”‚  â”‚   Leads    â”‚  â”‚   Calls    â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚   Admin    â”‚  â”‚  Scripts   â”‚  â”‚ Analytics  â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                                                   â”‚
â”‚  Hosted on: Cloudflare Pages                                    â”‚
â”‚  URL: https://interactive-sales-ca.pages.dev                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â”‚ HTTPS/JWT
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               AUTHENTICATION (Clerk.dev)                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  â€¢ User Login/Signup                                      â”‚  â”‚
â”‚  â”‚  â€¢ JWT Token Generation                                   â”‚  â”‚
â”‚  â”‚  â€¢ Role Management (Admin/Agent)                          â”‚  â”‚
â”‚  â”‚  â€¢ Session Management                                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â”‚ Bearer Token
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            API LAYER (Cloudflare Workers)                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Hono Framework Router                                    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚ /api/leads  â”‚  â”‚ /api/calls  â”‚  â”‚ /api/users  â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚/api/scripts â”‚  â”‚ /api/tasks  â”‚  â”‚/api/analyticsâ”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                                                   â”‚
â”‚  â€¢ JWT Verification                                              â”‚
â”‚  â€¢ RBAC Middleware                                               â”‚
â”‚  â€¢ Activity Logging                                              â”‚
â”‚  â€¢ Error Handling                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              DATABASE (Cloudflare D1 - SQLite)                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚  users   â”‚  â”‚  leads   â”‚  â”‚  calls   â”‚  â”‚  tasks   â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚conversationsâ”‚ â”‚ scripts â”‚  â”‚   tags   â”‚  â”‚activity_logsâ”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                                   â”‚
â”‚  â€¢ Triggers for auto-updates                                     â”‚
â”‚  â€¢ Views for complex queries                                     â”‚
â”‚  â€¢ Indexes for performance                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              STORAGE (Cloudflare R2)                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  ğŸ“ recordings/                                           â”‚  â”‚
â”‚  â”‚     â””â”€â”€ {lead_id}/                                        â”‚  â”‚
â”‚  â”‚         â””â”€â”€ {call_id}-{timestamp}.mp3                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                   â”‚
â”‚  â€¢ Call recordings                                               â”‚
â”‚  â€¢ Document attachments                                          â”‚
â”‚  â€¢ Export files                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Request Flow Diagram

### Example: Agent Creates a Lead

```
1. USER ACTION
   Agent clicks "Create Lead" button
   â””â”€> Fills in form: Name, Phone, Email, etc.

2. FRONTEND
   React Form Component
   â””â”€> Validates input
   â””â”€> Calls apiClient.createLead(data)

3. API CLIENT
   src/lib/api.ts
   â””â”€> Gets JWT token from Clerk
   â””â”€> Makes POST request to /api/leads
   â””â”€> Headers: { Authorization: "Bearer {token}" }

4. CLOUDFLARE WORKER
   functions/api/leads.ts
   â””â”€> Receives request
   â””â”€> Auth Middleware verifies JWT
   â””â”€> Extracts user info from token
   â””â”€> Checks user role (agent/admin)

5. VALIDATION
   â””â”€> Validates required fields
   â””â”€> Checks user permissions
   â””â”€> Assigns lead to agent

6. DATABASE
   Cloudflare D1
   â””â”€> INSERT INTO leads (...)
   â””â”€> Trigger: Update timestamp
   â””â”€> Returns lead_id

7. ACTIVITY LOG
   â””â”€> INSERT INTO activity_logs
   â””â”€> Records: "lead_created" by user_id

8. RESPONSE
   â””â”€> Returns created lead object
   â””â”€> Status: 201 Created

9. FRONTEND UPDATE
   â””â”€> Updates local state
   â””â”€> Shows success message
   â””â”€> Redirects to lead detail page
```

---

## ğŸ” Authentication Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    AUTHENTICATION FLOW                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. USER VISITS SITE
   â””â”€> https://interactive-sales-ca.pages.dev

2. PROTECTED ROUTE CHECK
   <ProtectedRoute> component
   â””â”€> useAuth() from Clerk
   â””â”€> Is user signed in?
       â”œâ”€> NO: Redirect to /login
       â””â”€> YES: Continue

3. LOGIN PAGE
   User enters email/password
   â””â”€> Clerk handles authentication
   â””â”€> On success: Creates session + JWT

4. TOKEN STORAGE
   JWT stored in:
   â””â”€> HTTP-only cookie (secure)
   â””â”€> Clerk session

5. API REQUESTS
   Every API call includes:
   â””â”€> Authorization: Bearer {jwt_token}

6. TOKEN VERIFICATION
   Cloudflare Worker middleware
   â””â”€> Extracts token from header
   â””â”€> Verifies with Clerk API
   â””â”€> Decodes user info
   â””â”€> Checks database for user
   â””â”€> Sets auth context

7. ROLE CHECK
   RoleGuard component / middleware
   â””â”€> Reads user.role from metadata
   â””â”€> Allows/denies based on role
       â”œâ”€> Admin: Full access
       â””â”€> Agent: Limited access

8. SESSION REFRESH
   Clerk auto-refreshes tokens
   â””â”€> Happens in background
   â””â”€> User stays logged in
```

---

## ğŸ“Š Database Entity Relationship Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    users    â”‚         â”‚    leads    â”‚         â”‚    calls    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)     â”‚â—„â”€â”€â”€â”    â”‚ id (PK)     â”‚â—„â”€â”€â”€â”    â”‚ id (PK)     â”‚
â”‚ clerk_id    â”‚    â”‚    â”‚ name        â”‚    â”‚    â”‚ lead_id (FK)â”‚
â”‚ email       â”‚    â””â”€â”€â”€â”€â”¤ assigned_to â”‚    â””â”€â”€â”€â”€â”¤ user_id (FK)â”‚
â”‚ full_name   â”‚         â”‚ created_by  â”‚         â”‚ call_date   â”‚
â”‚ role        â”‚         â”‚ status      â”‚         â”‚ duration    â”‚
â”‚ is_active   â”‚         â”‚ priority    â”‚         â”‚ outcome     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚ phone       â”‚         â”‚ notes       â”‚
                        â”‚ email       â”‚         â”‚ recording_urlâ”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚                       
                               â”‚                       
                               â–¼                       
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚conversationsâ”‚         â”‚    tasks    â”‚
                        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                        â”‚ id (PK)     â”‚         â”‚ id (PK)     â”‚
                        â”‚ lead_id (FK)â”‚         â”‚ lead_id (FK)â”‚
                        â”‚ user_id (FK)â”‚         â”‚ user_id (FK)â”‚
                        â”‚ message     â”‚         â”‚ title       â”‚
                        â”‚message_type â”‚         â”‚ due_date    â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚ status      â”‚
                                                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   scripts   â”‚         â”‚    tags     â”‚         â”‚ lead_tags   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)     â”‚         â”‚ id (PK)     â”‚         â”‚ lead_id (FK)â”‚
â”‚ title       â”‚         â”‚ name        â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”¤ tag_id (FK) â”‚
â”‚ content     â”‚         â”‚ color       â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ category    â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         (Many-to-Many)
â”‚ is_active   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ­ User Roles & Permissions Matrix

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Feature        â”‚    Admin     â”‚    Agent     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ View All Leads      â”‚      âœ…      â”‚      âŒ      â”‚
â”‚ View Assigned Leads â”‚      âœ…      â”‚      âœ…      â”‚
â”‚ Create Lead         â”‚      âœ…      â”‚      âœ…      â”‚
â”‚ Edit Any Lead       â”‚      âœ…      â”‚      âŒ      â”‚
â”‚ Edit Assigned Lead  â”‚      âœ…      â”‚      âœ…      â”‚
â”‚ Delete Lead         â”‚      âœ…      â”‚      âŒ      â”‚
â”‚ Assign Leads        â”‚      âœ…      â”‚      âŒ      â”‚
â”‚ Log Call            â”‚      âœ…      â”‚      âœ…      â”‚
â”‚ View All Calls      â”‚      âœ…      â”‚      âŒ      â”‚
â”‚ View Own Calls      â”‚      âœ…      â”‚      âœ…      â”‚
â”‚ Manage Users        â”‚      âœ…      â”‚      âŒ      â”‚
â”‚ View Analytics      â”‚      âœ…      â”‚      âœ…*     â”‚
â”‚ Manage Scripts      â”‚      âœ…      â”‚      âŒ      â”‚
â”‚ Export Data         â”‚      âœ…      â”‚      âŒ      â”‚
â”‚ System Settings     â”‚      âœ…      â”‚      âŒ      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

* Agent sees only their own performance
```

---

## ğŸš€ Deployment Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CLOUDFLARE NETWORK                          â”‚
â”‚                    (Global Edge Network)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚                 â”‚                 â”‚
            â–¼                 â–¼                 â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   Americas   â”‚  â”‚    Europe    â”‚  â”‚     Asia     â”‚
    â”‚  Edge Nodes  â”‚  â”‚  Edge Nodes  â”‚  â”‚  Edge Nodes  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                 â”‚                 â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚  Cloudflare Pages   â”‚
                   â”‚  (Frontend)         â”‚
                   â”‚  Static Assets      â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚ Cloudflare Workers  â”‚
                   â”‚ (API Backend)       â”‚
                   â”‚ Serverless Functionsâ”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚                           â”‚
                â–¼                           â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚   Cloudflare D1  â”‚        â”‚  Cloudflare R2   â”‚
     â”‚   (Database)     â”‚        â”‚   (Storage)      â”‚
     â”‚   SQLite         â”‚        â”‚   Recordings     â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ˆ Scalability Metrics

```
FREE TIER LIMITS:
â”œâ”€â”€ Cloudflare Pages
â”‚   â””â”€â”€ Unlimited requests âœ…
â”‚   â””â”€â”€ Unlimited bandwidth âœ…
â”‚
â”œâ”€â”€ Cloudflare Workers
â”‚   â””â”€â”€ 100,000 requests/day
â”‚   â””â”€â”€ ~3,000,000 requests/month
â”‚   â””â”€â”€ 50ms CPU time per request
â”‚
â”œâ”€â”€ Cloudflare D1
â”‚   â””â”€â”€ 5 GB storage
â”‚   â””â”€â”€ 5 Million row reads/day
â”‚   â””â”€â”€ 100,000 row writes/day
â”‚
â””â”€â”€ Cloudflare R2
    â””â”€â”€ 10 GB storage/month
    â””â”€â”€ 1 Million Class A operations
    â””â”€â”€ 10 Million Class B operations

ESTIMATED CAPACITY:
â”œâ”€â”€ Concurrent Users: 10,000+
â”œâ”€â”€ Daily Active Users: 1,000+
â”œâ”€â”€ Leads: 100,000+
â”œâ”€â”€ Calls: 50,000/month
â”œâ”€â”€ Recordings: 1,000 hours
â””â”€â”€ Response Time: <100ms globally
```

---

## ğŸ”„ Data Flow Examples

### Creating a Lead with Call Logging

```
1. Agent submits lead form
   â””â”€> POST /api/leads
       {
         "name": "John Doe",
         "phone": "+1234567890",
         "email": "john@example.com",
         "company": "Acme Corp"
       }

2. Worker creates lead record
   â””â”€> DB INSERT â†’ lead_id: 123
   â””â”€> Activity log created
   â””â”€> Returns lead object

3. Agent logs call
   â””â”€> POST /api/calls
       {
         "lead_id": 123,
         "duration": 180,
         "outcome": "answered",
         "notes": "Interested in product demo"
       }

4. Worker creates call record
   â””â”€> DB INSERT â†’ call_id: 456
   â””â”€> Trigger updates lead.last_contact
   â””â”€> Activity log created

5. Agent uploads recording
   â””â”€> POST /api/calls/456/recording
       FormData: recording.mp3

6. Worker stores in R2
   â””â”€> R2 PUT â†’ recordings/123/456-{timestamp}.mp3
   â””â”€> DB UPDATE calls.recording_url
   â””â”€> Returns public URL

7. Frontend refreshes
   â””â”€> Shows updated lead with call history
   â””â”€> Displays recording player
```

---

## ğŸ›¡ï¸ Security Architecture

```
LAYER 1: Network Security
â””â”€> Cloudflare DDoS Protection
â””â”€> Rate Limiting
â””â”€> WAF (Web Application Firewall)

LAYER 2: Authentication
â””â”€> Clerk JWT Tokens
â””â”€> HTTP-only Cookies
â””â”€> Token Expiration (7 days)
â””â”€> Refresh Token Rotation

LAYER 3: Authorization
â””â”€> Role-Based Access Control
â””â”€> Resource-Level Permissions
â””â”€> Middleware Checks on Every Request

LAYER 4: Data Protection
â””â”€> SQL Injection Prevention (Prepared Statements)
â””â”€> XSS Protection (React auto-escaping)
â””â”€> CORS Configuration
â””â”€> Content Security Policy

LAYER 5: Encryption
â””â”€> HTTPS/TLS for all traffic
â””â”€> Encrypted R2 storage
â””â”€> Encrypted database backups

LAYER 6: Audit Trail
â””â”€> Activity logs for all actions
â””â”€> IP address tracking
â””â”€> User agent logging
â””â”€> Timestamp for all events
```

---

## ğŸ“Š Performance Optimization

```
FRONTEND:
â”œâ”€â”€ Code Splitting (Vite)
â”œâ”€â”€ Lazy Loading Components
â”œâ”€â”€ React Query Caching
â”œâ”€â”€ Optimistic Updates
â””â”€â”€ Service Worker (offline support)

BACKEND:
â”œâ”€â”€ D1 Prepared Statements
â”œâ”€â”€ Database Indexes
â”œâ”€â”€ Efficient Queries (avoid N+1)
â”œâ”€â”€ Response Compression
â””â”€â”€ Edge Caching

NETWORK:
â”œâ”€â”€ CDN Distribution (Cloudflare)
â”œâ”€â”€ HTTP/2 & HTTP/3
â”œâ”€â”€ Brotli Compression
â”œâ”€â”€ Smart Routing
â””â”€â”€ Global Edge Network

DATABASE:
â”œâ”€â”€ Proper Indexing
â”œâ”€â”€ Database Views
â”œâ”€â”€ Query Optimization
â”œâ”€â”€ Connection Pooling
â””â”€â”€ Trigger-based Updates
```

---

This architecture provides a solid foundation for a scalable, secure, and performant CRM system!
